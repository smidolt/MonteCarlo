import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

data = pd.read_csv("prices.csv") # загрузить данные из файла CSV
price = np.array(data["Price"]).astype(float) # выбрать столбец Price и преобразовать его в массив numpy
returns = np.diff(price) / price[:-1] # посчитать доходность за каждый день
drift = np.mean(returns) * 252 # посчитать drift как среднюю доходность за год (умножаем на 252, потому что в году 252 торговых дня)
volatility = np.std(returns) * np.sqrt(252) # посчитать volatility как стандартное отклонение доходности за год (умножаем на корень из 252, потому что это масштабирует volatility на годовой уровень)

S0 = price[-1] # начальная цена BTC/USDT равна последней цене из данных (за 20 сентября 2021 года)
n = 1000 # количество симуляций
T = 504 # количество дней (торговых дней в два года)
dt = 1/T # длина каждого шага в годах
Z = np.random.normal(0, 1, (n, T)) # массив случайного шума из стандартного нормального распределения

S = np.zeros((n, T)) # массив цены BTC/USDT из нулей
S[:, 0] = S0 # первый столбец равен начальной цене BTC/USDT для всех сценариев

for t in range(1, T): # для каждого следующего шага (дня)
  S[:, t] = S[:, t-1] * np.exp((drift - 0.5 * volatility**2) * dt + volatility * np.sqrt(dt) * Z[:, t]) # применить формулу GBM для каждого сценария

plt.plot(S.T) # построить линии для каждого сценария
plt.xlabel("Дни") # подписать ось x
plt.ylabel("Цена BTC/USDT в долларах") # подписать ось y
plt.title("Симуляция движения цены BTC/USDT с GBM") # добавить заголовок графика
plt.show() # отобразить график

expected_price = np.mean(S[:, -1]) # ожидаемая цена BTC/USDT на конец периода
risk = np.std(S[:, -1]) # риск BTC/USDT на конец периода
print(f"Ожидаемая цена BTC/USDT на конец периода = {expected_price:.2f} долларов")
print(f"Риск BTC/USDT на конец периода = {risk:.2f} долларов")

p_higher = np.sum(S[:, -1] > 100000) / n # вероятность того, что цена BTC/USDT будет выше 100000 долларов
p_lower = np.sum(S[:, -1] < 20000) / n # вероятность того, что цена BTC/USDT будет ниже 20000 долларов
print(f"Вероятность того, что цена BTC/USDT будет выше 100000 долларов на конец периода = {p_higher:.2%}")
print(f"Вероятность того, что цена BTC/USDT будет ниже 20000 долларов на конец периода = {p_lower:.2%}")
